## Регулярное копирование БД и статических данных.

Для сохранности данных в базе данных и статического контента (фотографий и документов клиентов), стоит настроить регулярное копирование на удаленный сервер или, по крайней мере, на внешний жесткий диск. В случае нештатных ситуаций, это позволит достаточно быстро продолжить работу с минимальными потерями. 

Если сервер работает под управление ОС семейства Linux, самым простым вариантом будет настроить cron-задачу вроде наподобиве этой:

```0 5	 * * *  root	docker stop mks-app && mysqldump MYSQL_DATABASE -uMYSQL_USER -pMYSQL_PASSWORD -h127.0.0.1 --port MYSQL_PORT > /PATH_TO_DIR/mks-dbbackup-`date +\%Y\%m\%d`.sql && docker start mks-app```

Параметры MYSQL_DATABASE, MYSQL_USER, MYSQL_PASSWORD, MYSQL_PORT необходимо поменять не те, которые указаны в файлк .env. Кроме того PATH_TO_DIR нужно поменять на путь к директории, в которой будут временно храниться дампы БД.

В этом примере задача запускается каждый день в 5 утра. Сначала останавливатеся docker-контейнер с МКС, снимается дамп и МКС запускается снова.

Кроме данных из БД, необходимо регулярно сохранять статические данные, например так: 

```
10 5	 * * 6	root	mkdir -p /PATH_TO_DIR/uploads/\$(date +\\%Y\\%m\\%d) && cp -r /MKS_DIR/shared/homeless/web/uploads/ /PATH_TO_DIR/\$(date +\\%Y\\%m\\%d)
```
PATH_TO_DIR нужно поменять на путь к директории, в которой будут временно храниться картинки и документы. 
MKS_DIR необходимо изменить на путь, по которому расположена корневая директория МКС. 

В этом примере задача запускается в 5:10 утра каждую субботу.

После того, как создан дамп и скопированы статические данные, необходимо их перенести на удаленный сервер (при наличии) или, по крайней мере, на внешний жесткий диск.

```
0 6   * * *  root     rsync -avzh /PATH_TO_DIR/ USER@REMOTE_SERVER:/PATH_TO_DIR/
```
PATH_TO_DIR нужно поменять на путь к директории, в которой хранятся резервные копии; USER - на имя пользователя на удаленном сервер; REMOTE_SERVER - адрес удаленного сервера. 


## Рекомендации по защите данных

Если вы используете МКС на сервере, который имеет прямой доступ в интернет, будет целесообразным настроить огранчение доступа на сервер. Например, если в качестве web-сервера вы используете nginx, можно настроить на нем дополнительно [basic-авторизацию](https://nginx.org/ru/docs/http/ngx_http_auth_basic_module.html), чтобы снизить вероятность получения доступа злоумышленниками. А чтобы сотрудникам не приходилось каждый раз 2 раза авторизовываться, можно настроить, чтобы с доверенных IP-адресов (например, из офиса), Nginx не требовал basic-авторицию. Это можно сделать при помощи директивы [satisfy](http://nginx.org/ru/docs/http/ngx_http_core_module.html#satisfy).

